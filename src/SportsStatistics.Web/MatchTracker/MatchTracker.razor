@using SportsStatistics.Domain.MatchTracking.MatchEvents
@using SportsStatistics.Domain.MatchTracking.PlayerEvents
@using SportsStatistics.Domain.Players
<FluentStack HorizontalAlignment="HorizontalAlignment.Stretch" Orientation="Orientation.Vertical">

    <FluentLabel Typo="Typography.Subject" Weight="FontWeight.Bold">
        Match Tracker
    </FluentLabel>

    <FluentDataGrid Items="@OrderedPlayers" ShowHover="@true" RowSize="DataGridRowSize.Medium" GridTemplateColumns="0.10fr 0.50fr 0.50fr 0.25fr 0.25fr 0.25fr 0.25fr 0.25fr 0.25fr">
        <PropertyColumn Property="@(player => player.SquadNumber)" Title="#" />
        <PropertyColumn Property="@(player => player.Name)" />
        <PropertyColumn Property="@(player => player.PositionName)" Title="Position" />
        <TemplateColumn Title="Defensive" Align="Align.Center">
            @if (context.IsGoalkeeper)
            {
                <FluentButton IconEnd="@(new Icons.Filled.Size20.ShieldPerson())" Appearance="Appearance.Neutral" OnClick="@(() => AddSave(context))" Title="Save" Disabled="@(!MatchInProgess)" />
            }
            else
            {
                <FluentButton IconEnd="@(new Icons.Filled.Size20.PersonLightning())" Appearance="Appearance.Neutral" OnClick="@(() => AddTackle(context))" Title="Tackle" Disabled="@(!MatchInProgess)" />
            }
        </TemplateColumn>
        <TemplateColumn Title="Passing" Align="Align.Center">
            <FluentButton IconEnd="@(new Icons.Filled.Size20.PersonArrowRight().WithColor("var(--bs-success)"))" Appearance="Appearance.Neutral" OnClick="@(() => AddPassSuccess(context))" Title="Pass Success" Disabled="@(!MatchInProgess)" />
            <FluentButton IconEnd="@(new Icons.Filled.Size20.PersonArrowRight().WithColor("var(--bs-danger)"))" Appearance="Appearance.Neutral" OnClick="@(() => AddPassFailure(context))" Title="Pass Failure" Disabled="@(!MatchInProgess)" />
        </TemplateColumn>
        <TemplateColumn Title="Shooting" Align="Align.Center">
            <FluentButton IconEnd="@(new Icons.Filled.Size20.Target().WithColor("var(--bs-success)"))" Appearance="Appearance.Neutral" OnClick="@(() => AddShotOnTarget(context))" Title="Shot On Target" Disabled="@(!MatchInProgess)" />
            <FluentButton IconEnd="@(new Icons.Filled.Size20.TargetDismiss().WithColor("var(--bs-danger)"))" Appearance="Appearance.Neutral" OnClick="@(() => AddShotOffTarget(context))" Title="Shot Off Target" Disabled="@(!MatchInProgess)" />
        </TemplateColumn>
        <TemplateColumn Title="Goals" Align="Align.Center">
            <FluentButton IconEnd="@(new Icons.Filled.Size20.Handshake())" Appearance="Appearance.Neutral" OnClick="@(() => AddGoalAssist(context))" Title="Goal Assist" Disabled="@(!MatchInProgess)" />
            <FluentButton IconEnd="@(new Icons.Filled.Size20.SportSoccer().WithColor("var(--bs-success)"))" Appearance="Appearance.Neutral" OnClick="@(() => AddGoal(context))" Title="Goal" Disabled="@(!MatchInProgess)" />
            <FluentButton IconEnd="@(new Icons.Filled.Size20.SportSoccer().WithColor("#DD3636"))" Appearance="Appearance.Neutral" OnClick="@(() => AddOwnGoal(context))" Title="Own Goal" Disabled="@(!MatchInProgess)" />
        </TemplateColumn>
        <TemplateColumn Title="Fouls" Align="Align.Center">
            <FluentButton IconEnd="@(new Icons.Filled.Size20.PersonAlert().WithColor("var(--bs-success)"))" Appearance="Appearance.Neutral" OnClick="@(() => AddFoulWon(context))" Title="Foul Won" Disabled="@(!MatchInProgess)" />
            <FluentButton IconEnd="@(new Icons.Filled.Size20.PersonAlert().WithColor("var(--bs-danger)"))" Appearance="Appearance.Neutral" OnClick="@(() => AddFoulConceeded(context))" Title="Foul Conceeded" Disabled="@(!MatchInProgess)" />
        </TemplateColumn>
        <TemplateColumn Title="Discipline" Align="Align.Center">
            <FluentButton IconEnd="@(new Icons.Filled.Size20.DocumentBorder().WithColor("#FFCE2C"))" Appearance="Appearance.Neutral" OnClick="@(() => AddYellowCard(context))" Title="Yellow Card" Disabled="@(!MatchInProgess)" />
            <FluentButton IconEnd="@(new Icons.Filled.Size20.DocumentBorder().WithColor("#DD3636"))" Appearance="Appearance.Neutral" OnClick="@(() => AddRedCard(context))" Title="Red Card" Disabled="@(!MatchInProgess)" />
        </TemplateColumn>
        <TemplateColumn Align="Align.End">
            <FluentButton IconEnd="@(new Icons.Filled.Size20.PersonSwap())" Appearance="Appearance.Neutral" Title="Substitute" />
            @* <FluentButton IconEnd="@(new Icons.Filled.Size20.ArrowSwap())" Appearance="Appearance.Neutral" Title="Substitute" /> *@
        </TemplateColumn>
    </FluentDataGrid>

</FluentStack>

@code {
    [Parameter] public List<PlayerDto> Players { get; set; } = [];

    [Parameter] public EventCallback<MatchEventDto> OnAddMatchEvent { get; set; }

    [Parameter] public bool MatchInProgess { get; set; }

    private IQueryable<PlayerDto> OrderedPlayers => Players.OrderBy(player => player.PositionId).ThenBy(player => player.Name).AsQueryable();

    private async Task AddPlayerMatchEvent(PlayerDto player, PlayerEventType type)
    {
        var occuredAtUtc = DateTime.UtcNow;
        var matchEvent = new MatchEventDto($"{player.Name} - {type}", occuredAtUtc);

        await OnAddMatchEvent.InvokeAsync(matchEvent);
    }

    private async Task AddPassSuccess(PlayerDto player)
    {
        await AddPlayerMatchEvent(player, PlayerEventType.PassSuccess);
    }

    private async Task AddPassFailure(PlayerDto player)
    {
        await AddPlayerMatchEvent(player, PlayerEventType.PassFailure);
    }

    private async Task AddShotOnTarget(PlayerDto player)
    {
        await AddPlayerMatchEvent(player, PlayerEventType.ShotOnTarget);
    }

    private async Task AddShotOffTarget(PlayerDto player)
    {
        await AddPlayerMatchEvent(player, PlayerEventType.ShotOffTarget);
    }

    private async Task AddGoal(PlayerDto player)
    {
        await AddPlayerMatchEvent(player, PlayerEventType.Goal);
    }

    private async Task AddGoalAssist(PlayerDto player)
    {
        await AddPlayerMatchEvent(player, PlayerEventType.GoalAssist);
    }

    private async Task AddOwnGoal(PlayerDto player)
    {
        await AddPlayerMatchEvent(player, PlayerEventType.OwnGoal);
    }

    private async Task AddSave(PlayerDto player)
    {
        await AddPlayerMatchEvent(player, PlayerEventType.Save);
    }

    private async Task AddTackle(PlayerDto player)
    {
        await AddPlayerMatchEvent(player, PlayerEventType.Tackle);
    }

    private async Task AddFoulWon(PlayerDto player)
    {
        await AddPlayerMatchEvent(player, PlayerEventType.FoulWon);
    }

    private async Task AddFoulConceeded(PlayerDto player)
    {
        await AddPlayerMatchEvent(player, PlayerEventType.FoulConceeded);
    }

    private async Task AddYellowCard(PlayerDto player)
    {
        await AddPlayerMatchEvent(player, PlayerEventType.YellowCard);
    }

    private async Task AddRedCard(PlayerDto player)
    {
        await AddPlayerMatchEvent(player, PlayerEventType.RedCard);
    }
}
