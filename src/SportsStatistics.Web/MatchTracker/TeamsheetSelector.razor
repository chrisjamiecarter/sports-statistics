<FluentStack HorizontalAlignment="HorizontalAlignment.Stretch" Orientation="Orientation.Vertical">

    <FluentLabel Typo="Typography.Subject" Weight="FontWeight.Bold">
        Select Starting XI
    </FluentLabel>

    <FluentLabel Typo="Typography.Body" Weight="FontWeight.Normal">
        Choose 11 players for today's fixture.
    </FluentLabel>

    <FluentDataGrid Items="@OrderedPlayers" ShowHover="@true">
        <SelectColumn TGridItem="PlayerDto" SelectMode="DataGridSelectMode.Multiple" SelectFromEntireRow="@true" @bind-SelectedItems="@SelectedPlayers" />
        <PropertyColumn Property="@(player => player.Position)" />
        <PropertyColumn Property="@(player => player.Name)" />
    </FluentDataGrid>

    <FluentButton Appearance="Appearance.Accent" OnClick="ConfirmTeamsheet">
        Confirm Teamsheet
    </FluentButton>

    <FluentButton Appearance="Appearance.Outline" OnClick="Cancel">
        Cancel
    </FluentButton>

</FluentStack>


@code {
    [Parameter] public List<PlayerDto> Players { get; set; } = [];

    [Parameter] public EventCallback<IReadOnlyList<PlayerDto>> OnTeamsheetConfirmed { get; set; }

    [Parameter] public EventCallback OnCancelled { get; set; }

    private const int PlayersRequired = 11;

    private IQueryable<PlayerDto> OrderedPlayers => Players.OrderBy(player => player.PostionId).ThenBy(player => player.Name).AsQueryable();

    private IEnumerable<PlayerDto> SelectedPlayers { get; set; } = [];

    private bool IsValid => SelectedPlayers.Count() == PlayersRequired;

    private async Task ConfirmTeamsheet()
    {
        if (IsValid)
        {
            await OnTeamsheetConfirmed.InvokeAsync(SelectedPlayers.ToList());
        }
        else
        {
            ToastService.ShowError("Teamsheet must be exactly 11 players");
        }
    }

    private async Task Cancel()
    {
        // SelectedPlayers = [];
        await OnCancelled.InvokeAsync();
    }
}
